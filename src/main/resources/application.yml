server:
  port: ${APP_PORT:8080}
  forward-headers-strategy: framework

spring:
  application:
    name: musicapi

  datasource:
    url: ${DB_URL:jdbc:postgresql://localhost:5432/musicapi}
    username: ${DB_USERNAME:musicapi}
    password: ${DB_PASSWORD:musicapi}
    driver-class-name: org.postgresql.Driver

  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        format_sql: true
    show-sql: false

  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration

  servlet:
    multipart:
      enabled: true
      max-file-size: ${MAX_FILE_SIZE:20MB}
      max-request-size: ${MAX_REQUEST_SIZE:50MB}

  main:
    banner-mode: "off"

# -----------------------
# Segurança / JWT / CORS
# -----------------------
security:
  jwt:
    issuer: ${JWT_ISSUER:musicapi}
    secret: ${JWT_SECRET:CHANGE_ME_SUPER_SECRET_64_CHARS_MIN}
    access-token-exp-minutes: ${JWT_ACCESS_EXP_MINUTES:5}
    refresh-token-exp-days: ${JWT_REFRESH_EXP_DAYS:7}
  ratelimit:
    requests-per-minute: ${RATE_LIMIT_REQ_PER_MIN:10}

cors:
  allowlist:
    # Lista separada por vírgula. Ex.: https://meudominio.gov.br,https://outro.gov.br
    origins: ${CORS_ALLOWLIST_ORIGINS:http://localhost:3000,http://localhost:8080}
  # Domínio do serviço (bloqueio para domínios fora do domínio do serviço)
  service-domain: ${SERVICE_DOMAIN:localhost}

# -----------------------
# Rate Limiting
# -----------------------
ratelimit:
  requests-per-minute: ${RATE_LIMIT_RPM:10}

# -----------------------
# MinIO (S3 compatível)
# -----------------------
minio:
  endpoint: ${MINIO_ENDPOINT:http://localhost:9000}
  access-key: ${MINIO_ACCESS_KEY:minioadmin}
  secret-key: ${MINIO_SECRET_KEY:minioadmin}
  bucket: ${MINIO_BUCKET:musicapi}
  presigned-url-exp-minutes: ${MINIO_PRESIGNED_EXP_MINUTES:30}

# -----------------------
# Integração Externa
# -----------------------
integration:
  regionais:
    base-url: ${REGIONAIS_BASE_URL:https://integrador-argus-api.geia.vip}
    path: ${REGIONAIS_PATH:/v1/regionais}
    timeout-ms: ${REGIONAIS_TIMEOUT_MS:5000}

# -----------------------
# Actuator (Health / Liveness / Readiness)
# -----------------------
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      probes:
        enabled: true
      show-details: never
  health:
    livenessstate:
      enabled: true
    readinessstate:
      enabled: true

# -----------------------
# OpenAPI / Swagger
# -----------------------
springdoc:
  api-docs:
    path: /api/v1/docs
  swagger-ui:
    path: /swagger-ui.html
    operationsSorter: method
    tagsSorter: alpha

# -----------------------
# Logging
# -----------------------
logging:
  level:
    root: ${LOG_LEVEL_ROOT:INFO}
    org.springframework.security: ${LOG_LEVEL_SECURITY:INFO}
    org.hibernate.SQL: ${LOG_LEVEL_HIBERNATE_SQL:WARN}
